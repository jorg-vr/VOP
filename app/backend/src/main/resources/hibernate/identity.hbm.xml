<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
    <class name="model.identity.Identity" table="identities">
        <meta attribute="class-description">
            This class contains the account detail.
        </meta>
        <id name="uuid" type="uuid-binary" column="id">
            <generator class="uuid2"/>
        </id>

        <many-to-one name="address" column="address_id" class="model.identity.Address" lazy="proxy" fetch="select" cascade="all"/>
        <property name="phoneNumber" column="phonenumber" type="string"/>
        <joined-subclass name="model.identity.Company" table="companies">
            <key column="identity_id"/>
            <property name="name" column="name" type="string"/>
            <property name="btwNumber" column="btw_number" type="string"/>
            <property name="invoicePeriodicity">
                <type name="org.hibernate.type.EnumType">
                    <param name="enumClass">model.identity.Periodicity</param>
                </type>
            </property>
            <property name="statementPeriodicity">
                <type name="org.hibernate.type.EnumType">
                    <param name="enumClass">model.identity.Periodicity</param>
                </type>
            </property>
            <joined-subclass name="model.identity.Customer" table="customers">
                <key column="identity_id"/>
                <bag name="fleets" access="field" table="fleets"
                     lazy="true" fetch="select" inverse="true">
                    <key column="owner_id" not-null="true"/>
                    <one-to-many class="model.fleet.Fleet" />
                </bag>
                <bag name="contracts" access="field" table="contracts"
                     lazy="true" fetch="select" inverse="true">
                    <key column="customer_id" not-null="true"/>
                    <one-to-many class="model.insurance.Contract" />
                </bag>
                <map name="commissions"
                     table="customer_commissions" cascade="all">
                    <key column="customer_id"/>

                    <map-key column="surety_type">
                        <type name = "org.hibernate.type.EnumType" >
                            <param name="enumClass" >model.insurance.SuretyType</param>
                        </type>
                    </map-key>
                    <element column="value" type="java.lang.Double"/>
                </map>
            </joined-subclass>
            <joined-subclass name="model.identity.InsuranceCompany" table="insurancecompanies">
                <key column="identity_id"/>
                <bag name="contracts" access="field" table="contracts"
                     lazy="true" fetch="select" inverse="true">
                    <key column="company_id" not-null="true"/>
                    <one-to-many class="model.insurance.Contract" />
                </bag>
            </joined-subclass>

        </joined-subclass>

    </class>
</hibernate-mapping>